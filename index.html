<script>
    const products = JSON.parse(localStorage.getItem("products") || "[]");
    let cart = JSON.parse(localStorage.getItem("cart") || "[]");
    let categories = JSON.parse(localStorage.getItem("categories") || '["Shirts", "Pants", "Accessories"]');
    let isAdmin = false;
    let currentTheme = localStorage.getItem("theme") || "light";
    
    function initializeTheme() {
      document.documentElement.setAttribute('data-theme', currentTheme);
      updateThemeButton();
    }
    
    function toggleTheme() {
      currentTheme = currentTheme === "light" ? "dark" : "light";
      document.documentElement.setAttribute('data-theme', currentTheme);
      localStorage.setItem("theme", currentTheme);
      updateThemeButton();
    }
    
    function updateThemeButton() {
      const button = document.querySelector('.theme-toggle');
      if (button) {
        button.innerHTML = currentTheme === "light" ? "üåô Dark" : "‚òÄÔ∏è Light";
      }
    }

    function renderProducts() {
      const list = document.getElementById("product-list");
      list.innerHTML = "";
      
      if (products.length === 0) {
        list.innerHTML = `
          <div class="card" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
            <h3 style="color: var(--text-color); margin-bottom: 1rem;">No products available</h3>
            <p style="color: var(--text-color); opacity: 0.7;">Check back later for new arrivals!</p>
          </div>
        `;
        return;
      }
      
      products.forEach((product, index) => {
        const div = document.createElement("div");
        div.className = "product-card fade-in";
        div.innerHTML = `
          <img src="${product.image}" alt="${product.name}" class="product-image" />
          <div class="product-info">
            <div class="product-name">${product.name}</div>
            <div class="product-category">${product.category}</div>
            <div class="product-price">$${parseFloat(product.price).toFixed(2)}</div>
            <button class="btn btn-primary" onclick="addToCart(${index})" style="width: 100%;">
              Add to Cart
            </button>
            ${isAdmin ? `<button class="btn btn-secondary" onclick="removeProduct(${index})" style="width: 100%; margin-top: 0.5rem;">Remove</button>` : ""}
          </div>
        `;
        list.appendChild(div);
      });
    }

    function renderCart() {
      const list = document.getElementById("cart-list");
      const totalDisplay = document.getElementById("cart-total");
      list.innerHTML = "";
      let total = 0;
      
      if (cart.length === 0) {
        list.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: var(--text-color); opacity: 0.7;">
            <p>Your cart is empty</p>
          </div>
        `;
        totalDisplay.innerHTML = "Total: $0.00";
        return;
      }
      
      cart.forEach((item, index) => {
        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
          <div>
            <strong>${item.name}</strong>
            <div style="font-size: 0.9rem; color: var(--text-color); opacity: 0.7;">${item.category}</div>
          </div>
          <div style="display: flex; align-items: center; gap: 1rem;">
            <span style="font-weight: 600; color: var(--accent-color);">$${parseFloat(item.price).toFixed(2)}</span>
            <button class="btn btn-secondary" onclick="removeFromCart(${index})" style="padding: 6px 12px; font-size: 12px;">Remove</button>
          </div>
        `;
        list.appendChild(div);
        total += parseFloat(item.price);
      });
      totalDisplay.innerHTML = `Total: $${total.toFixed(2)}`;
    }

    function addToCart(index) {
      cart.push(products[index]);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
      
      // Show success feedback
      const button = event.target;
      const originalText = button.innerHTML;
      button.innerHTML = "‚úì Added!";
      button.style.background = "var(--gold-color)";
      setTimeout(() => {
        button.innerHTML = originalText;
        button.style.background = "";
      }, 1000);
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    function renderCategories() {
      const categorySelect = document.getElementById("product-category");
      const categoryList = document.getElementById("category-list");
      
      if (categorySelect) {
        categorySelect.innerHTML = "";
        categories.forEach(category => {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          categorySelect.appendChild(option);
        });
      }
      
      if (isAdmin && categoryList) {
        categoryList.innerHTML = "<h4 style='margin-bottom: 1rem; color: var(--text-color);'>Current Categories:</h4>";
        categories.forEach((category, index) => {
          const div = document.createElement("div");
          div.style.marginBottom = "0.5rem";
          div.style.display = "flex";
          div.style.justifyContent = "space-between";
          div.style.alignItems = "center";
          div.style.padding = "0.5rem";
          div.style.background = "var(--bg-color)";
          div.style.borderRadius = "6px";
          div.innerHTML = `
            <span style="color: var(--text-color);">${category}</span>
            <button class="btn btn-secondary" onclick="removeCategory(${index})" style="padding: 4px 8px; font-size: 12px;">Remove</button>
          `;
          categoryList.appendChild(div);
        });
      }
    }

    function addCategory() {
      const newCategory = document.getElementById("new-category").value.trim();
      if (!newCategory) {
        alert("Please enter a category name.");
        return;
      }
      if (categories.includes(newCategory)) {
        alert("Category already exists.");
        return;
      }
      categories.push(newCategory);
      localStorage.setItem("categories", JSON.stringify(categories));
      document.getElementById("new-category").value = "";
      renderCategories();
    }

    function removeCategory(index) {
      const categoryToRemove = categories[index];
      if (!confirm(`Remove category "${categoryToRemove}"? This will also remove all products in this category.`)) return;
      
      categories.splice(index, 1);
      localStorage.setItem("categories", JSON.stringify(categories));
      
      for (let i = products.length - 1; i >= 0; i--) {
        if (products[i].category === categoryToRemove) {
          products.splice(i, 1);
        }
      }
      localStorage.setItem("products", JSON.stringify(products));
      
      renderCategories();
      renderProducts();
    }

    function addProduct() {
      const name = document.getElementById("product-name").value.trim();
      const price = document.getElementById("product-price").value.trim();
      const imageFile = document.getElementById("product-image").files[0];
      const category = document.getElementById("product-category").value;
      
      if (!name || !price || !imageFile || !category) {
        alert("Please fill all fields and select an image.");
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const imageDataUrl = e.target.result;
        products.push({ name, price, image: imageDataUrl, category });
        localStorage.setItem("products", JSON.stringify(products));
        renderProducts();
        
        document.getElementById("product-name").value = "";
        document.getElementById("product-price").value = "";
        document.getElementById("product-image").value = "";
        
        alert("Product added successfully!");
      };
      reader.readAsDataURL(imageFile);
    }

    function removeProduct(index) {
      if (!confirm("Remove this product?")) return;
      products.splice(index, 1);
      localStorage.setItem("products", JSON.stringify(products));
      renderProducts();
    }

    function loginAdmin() {
      const username = document.getElementById("admin-username").value;
      const password = document.getElementById("admin-password").value;
      
      // Admin credentials
      const admins = [
        { username: "farida", password: "farida_creator17" },
        { username: "renada", password: "renada_fashion18" },
        { username: "habiba", password: "habiba_designer18" },
        { username: "youssef", password: "youssef_dev15" }
      ];
      
      // Check if credentials match any admin
      const isValidAdmin = admins.some(admin => 
        admin.username === username && admin.password === password
      );
      
      if (isValidAdmin) {
        isAdmin = true;
        document.getElementById("admin-login").classList.add("hidden");
        document.getElementById("admin-panel").classList.remove("hidden");
        document.getElementById("customer-panel").classList.add("hidden");
        renderCategories();
        renderProducts();
      } else {
        alert("Incorrect credentials.");
      }
    }

    function showAdminLogin() {
      document.getElementById("admin-login").classList.remove("hidden");
      document.getElementById("admin-panel").classList.add("hidden");
      document.getElementById("customer-panel").classList.add("hidden");
    }

    function showCustomerPanel() {
      isAdmin = false;
      document.getElementById("admin-login").classList.add("hidden");
      document.getElementById("admin-panel").classList.add("hidden");
      document.getElementById("customer-panel").classList.remove("hidden");
      renderCategories();
      renderProducts();
      renderCart();
    }

    function checkoutCart() {
      if (cart.length === 0) {
        alert("Your cart is empty!");
        return;
      }
      const total = cart.reduce((acc, item) => acc + parseFloat(item.price), 0).toFixed(2);
      alert(`Thank you for your purchase! Total: $${total}`);
      cart = [];
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    }

    // Initialize
    initializeTheme();
    renderCategories();
    showCustomerPanel();
  </script>
